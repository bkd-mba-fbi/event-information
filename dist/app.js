var isString=a=>typeof a=='string',evtToken='evtToken',settings=window.eventInformation.settings,buildingId=getParameterByName('buildingId'),instanceId=getParameterByName('instance'),roomId=getParameterByName('roomId'),refresh=getParameterByName('refresh'),color=getParameterByName('color'),headerColor=getParameterByName('headerColor'),siteChange=getParameterByName('siteChange'),rooms=null,scrollPosition=0;let navigatorLanguage=navigator.language.split('-')[0]=='fr'?'fr-CH':'de-CH';function setAccessToken(value){sessionStorage.setItem(evtToken,value)}function getAccessToken(){let item=sessionStorage.getItem(evtToken);return item!==void 0?item:null}function getParameterByName(name,url){!isString(url)&&(url=window.location.href);name=name.replace(/[[\]]/g,'\\url');var regex=RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),results=regex.exec(url);if(!results)return null;if(!results[2])return'';return decodeURIComponent(results[2].replace(/\+/g,' '))}function isLoggedIn(){let accessToken=getAccessToken();let tokenExpire=accessToken==null?null:parseJWT(accessToken).exp*1000;if(accessToken==null||(tokenExpire!==null&&Date.now()>=tokenExpire))return!1;let payload=parseJWT(accessToken);return instanceId==payload.instance_id&&payload.culture_info==navigatorLanguage}function parseJWT(accessToken){return JSON.parse(atob(accessToken.split('.')[1]))}function checkToken(){let accessToken=getParameterByName('access_token');accessToken!==null&&(setAccessToken(accessToken),location.href.indexOf('?access_token')>0?location.replace(location.href.split('?')[0]):location.replace(location.href.substring(0,location.href.indexOf('&access_token'))))}function autoCheckForLogin(){if(isLoggedIn())return Promise.resolve();location.replace(`${settings.authUrl}/Authorization/${instanceId}/Token?clientId=${settings.clientId}&redirectUrl=${location.href}&culture_info=${navigatorLanguage}&application_scope=Public`);return new Promise(()=>{})}function scroll(){siteChange=siteChange>0?siteChange*1000:3500;setInterval(()=>{scrollPosition=document.getElementById('events').getBoundingClientRect().height<=scrollPosition?0:(scrollPosition+screen.availHeight)-document.getElementById('header').getBoundingClientRect().height;window.scrollTo(0,scrollPosition)},siteChange)}async function getData(url){var response=await fetch(url,{method:'GET',headers:{'CLX-Authorization':'token_type=urn:ietf:params:oauth:token-type:jwt-bearer, access_token='+getAccessToken()}});return response.json()}function getRoomReservation(){autoCheckForLogin();let now=new Date();let from=`${now-(60000*5)}`;let to=`${now.setHours(23)}`;from=from.substring(0,10);to=to.substring(0,10);getData(settings.restUrl+`/RoomReservation/Rooms/Occupancies/?filter.DateTimeFrom=${from}&filter.DateTimeTo=${to}&sort=DateTimeFrom.asc`).then(data=>{var table=document.getElementById('events');for(const tr of document.querySelectorAll('tr'))tr.remove();for(const element of data){var displayColor=color==null?element.DisplayColor:`#${color}`,roomsFiltered=rooms.filter(r=>r.Id==element.ResourceId);if(roomsFiltered.length>0&&displayColor==element.DisplayColor){var row=table.insertRow(),time=row.insertCell(0),designation=row.insertCell(1);time.innerHTML=element.DateTimeFrom.split('T')[1].substring(0,5)+' - '+element.DateTimeTo.split('T')[1].substring(0,5);time.classList.add('medium');designation.innerHTML=element.Designation;designation.classList.add('large');if(rooms.length>1){var floor=row.insertCell(2),room=row.insertCell(3);floor.classList.add('small');floor.innerHTML=roomsFiltered[0].Floor;room.classList.add('small');room.innerHTML=element.Ressource}document.getElementById('events').style.marginTop=document.getElementById('header').getBoundingClientRect().height+'px'}}})}(buildingId==null||roomId==null)&&instanceId==null?window.alert('Param instanceId and buildingId or roomId must be set: '+location.host+'?instance={id}&buildingId={id} to url'):checkToken();
